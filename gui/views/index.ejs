<!DOCTYPE html>
<html>
<head>
  <title>K8s CR Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="flex justify-between items-center mb-4">
		<h1 class="text-2xl font-bold">Custom Resources</h1>
		<div class="flex items-center space-x-4">
			<div class="flex items-center space-x-2">
				<input id="autorefresh" type="checkbox" <%= req.query.autorefresh === 'true' ? 'checked' : '' %> />
				<label for="autorefresh" class="text-sm">Auto-refresh</label>
			</div>
			<a href="/create" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Create CR</a>
		</div>
	</div>
  <table class="table-auto w-full bg-white shadow-md rounded-lg overflow-hidden border-collapse">
    <thead class="bg-gray-200">
      <tr>
        <th class="px-4 py-2 text-left border-r border-gray-300">Name</th>
        <th class="px-4 py-2 text-left border-r border-gray-300">Display Name</th>
        <th class="px-4 py-2 text-left border-r border-gray-300">Dedicated DB</th>
        <th class="px-4 py-2 text-left border-r border-gray-300">Performance Tier</th>
        <th class="px-4 py-2 text-left">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% crs.forEach(cr => { %>
        <tr class="border-t">
          <td class="px-4 py-2 font-medium border-r border-gray-200"><%= cr.metadata.name %></td>
          <td class="px-4 py-2 border-r border-gray-200"><%= cr.spec.displayName || '-' %></td>
          <td class="px-4 py-2 text-left border-r border-gray-200">
            <% if (cr.spec.database && cr.spec.database.dedicatedInstance) { %>
              <span class="text-xl">✅</span>
            <% } else { %>
              <span class="text-xl">⛔</span>
            <% } %>
          </td>
          <td class="px-4 py-2 border-r border-gray-200">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full 
              <%= (cr.spec.database && cr.spec.database.performanceTier === 'enterprise') ? 'bg-purple-100 text-purple-800' : 
                  (cr.spec.database && cr.spec.database.performanceTier === 'premium') ? 'bg-blue-100 text-blue-800' : 
                  'bg-gray-100 text-gray-800' %>">
              <%= (cr.spec.database && cr.spec.database.performanceTier) ? cr.spec.database.performanceTier : 'standard' %>
            </span>
          </td>
          <td class="px-4 py-2">
            <div class="flex space-x-2">
              <a href="/edit/<%= cr.metadata.name %>" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Edit</a>
              <form method="POST" action="/delete/<%= cr.metadata.name %>" onsubmit="return confirm('Delete <%= cr.metadata.name %>?')" class="inline">
                <button class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Delete</button>
              </form>
            </div>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</body>
<script>
  const checkbox = document.getElementById('autorefresh')

  checkbox.addEventListener('change', () => {
    const params = new URLSearchParams(window.location.search)
    if (checkbox.checked) {
      params.set('autorefresh', 'true')
    } else {
      params.delete('autorefresh')
    }
    window.location.search = params.toString()
  })

  if (checkbox.checked) {
    setInterval(() => {
      const params = new URLSearchParams(window.location.search)
      params.set('autorefresh', 'true')
      window.location.search = params.toString()
    }, 10000)
  }
</script>
</html>
